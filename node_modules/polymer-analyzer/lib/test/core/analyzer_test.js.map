{"version":3,"sources":["test/core/analyzer_test.ts"],"names":[],"mappings":"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","file":"analyzer_test.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2016 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/// <reference path=\"../../../node_modules/@types/mocha/index.d.ts\" />\n\nimport {assert, use} from 'chai';\nimport * as clone from 'clone';\nimport * as estree from 'estree';\nimport * as path from 'path';\nimport * as shady from 'shady-css-parser';\n\nimport {Analyzer} from '../../core/analyzer';\nimport {Deferred} from '../../core/utils';\nimport {ParsedCssDocument} from '../../css/css-document';\nimport {ParsedHtmlDocument} from '../../html/html-document';\nimport {HtmlParser} from '../../html/html-parser';\nimport {ScriptTagImport} from '../../html/html-script-tag';\nimport {JavaScriptDocument} from '../../javascript/javascript-document';\nimport {Document, Import, ScannedImport, ScannedInlineDocument, Severity} from '../../model/model';\nimport {FSUrlLoader} from '../../url-loader/fs-url-loader';\nimport {InMemoryOverlayUrlLoader} from '../../url-loader/overlay-loader';\nimport {UrlLoader} from '../../url-loader/url-loader';\n\nimport {CodeUnderliner, invertPromise} from '../test-utils';\n\nimport chaiAsPromised = require('chai-as-promised');\nimport chaiSubset = require('chai-subset');\nimport stripIndent = require('strip-indent');\n\nuse(chaiSubset);\nuse(chaiAsPromised);\n\nfunction getOnly<V>(iter: Iterable<V>): V {\n  const arr = Array.from(iter);\n  assert.equal(arr.length, 1);\n  return arr[0]!;\n}\n\nconst testDir = path.join(__dirname, '..');\n\nsuite('Analyzer', () => {\n  let analyzer: Analyzer;\n  let inMemoryOverlay: InMemoryOverlayUrlLoader;\n  let underliner: CodeUnderliner;\n\n  async function analyzeDocument(\n      url: string, localAnalyzer?: Analyzer): Promise<Document> {\n    localAnalyzer = localAnalyzer || analyzer;\n    const document =\n        (await localAnalyzer.analyze([url])).getDocument(url) as Document;\n    assert.instanceOf(document, Document);\n    return document;\n  };\n\n  setup(() => {\n    const underlyingUrlLoader = new FSUrlLoader(testDir);\n    inMemoryOverlay = new InMemoryOverlayUrlLoader(underlyingUrlLoader);\n    analyzer = new Analyzer({urlLoader: inMemoryOverlay});\n    underliner = new CodeUnderliner(inMemoryOverlay);\n  });\n\n  test('canLoad delegates to the urlLoader canLoad method', () => {\n    assert.isTrue(analyzer.canLoad('/'), '/');\n    assert.isTrue(analyzer.canLoad('/path'), '/path');\n    assert.isFalse(analyzer.canLoad('../path'), '../path');\n    assert.isFalse(analyzer.canLoad('http://host/'), 'http://host/');\n    assert.isFalse(analyzer.canLoad('http://host/path'), 'http://host/path');\n  });\n\n  suite('canResolveUrl()', () => {\n    test('canResolveUrl defaults to not resolving external urls', () => {\n      assert.isTrue(analyzer.canResolveUrl('/path'), '/path');\n      assert.isTrue(analyzer.canResolveUrl('../path'), '../path');\n      assert.isFalse(analyzer.canResolveUrl('http://host'), 'http://host');\n      assert.isFalse(\n          analyzer.canResolveUrl('http://host/path'), 'http://host/path');\n    });\n  });\n\n  suite('analyze()', () => {\n\n    test(\n        'analyzes a document with an inline Polymer element feature',\n        async() => {\n          const document = await analyzeDocument(\n              'static/analysis/simple/simple-element.html');\n          const elements = Array.from(\n              document.getFeatures({kind: 'element', imported: false}));\n          assert.deepEqual(elements.map((e) => e.tagName), ['simple-element']);\n        });\n\n    test(\n        'analyzes a document with an external Polymer element feature',\n        async() => {\n          const document =\n              await analyzeDocument('static/analysis/separate-js/element.html');\n          const elements = Array.from(\n              document.getFeatures({kind: 'element', imported: true}));\n          assert.deepEqual(elements.map((e) => e.tagName), ['my-element']);\n        });\n\n    test('gets source ranges of documents correct', async() => {\n      const document = await analyzeDocument('static/dependencies/root.html');\n      assert.deepEqual(await underliner.underline(document.sourceRange), `\n<link rel=\"import\" href=\"inline-only.html\">\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n<link rel=\"import\" href=\"leaf.html\">\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n<link rel=\"import\" href=\"inline-and-imports.html\">\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n<link rel=\"import\" href=\"subfolder/in-folder.html\">\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n<link rel=\"lazy-import\" href=\"lazy.html\">\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n`);\n    });\n\n    test('analyzes inline scripts correctly', async() => {\n      const document = await analyzeDocument(\n          'static/inline-documents/inline-documents.html');\n      const jsDocuments = document.getFeatures({kind: 'js-document'});\n      assert.equal(jsDocuments.size, 1);\n      const jsDocument = getOnly(jsDocuments);\n      assert.isObject(jsDocument.astNode);\n      assert.equal(jsDocument.astNode!.tagName, 'script');\n      assert.deepEqual(await underliner.underline(jsDocument.sourceRange), `\n  <script>\n          ~\n    console.log('hi');\n~~~~~~~~~~~~~~~~~~~~~~\n  </script>\n~~`);\n    });\n\n    test('analyzes inline styles correctly', async() => {\n      const document = await analyzeDocument(\n          'static/inline-documents/inline-documents.html');\n      const cssDocuments = document.getFeatures({kind: 'css-document'});\n      const cssDocument = getOnly(cssDocuments);\n      assert.isObject(cssDocument.astNode);\n      assert.equal(cssDocument.astNode!.tagName, 'style');\n      assert.deepEqual(await underliner.underline(cssDocument.sourceRange), `\n  <style>\n         ~\n    body {\n~~~~~~~~~~\n      color: red;\n~~~~~~~~~~~~~~~~~\n    }\n~~~~~\n  </style>\n~~`);\n    });\n\n    test('analyzes a document with an import', async() => {\n      const document =\n          await analyzeDocument('static/analysis/behaviors/behavior.html');\n      const behaviors =\n          Array.from(document.getFeatures({kind: 'behavior', imported: true}));\n      assert.deepEqual(\n          behaviors.map((b) => b.className),\n          ['MyNamespace.SubBehavior', 'MyNamespace.SimpleBehavior']);\n    });\n\n    test(\n        'creates \"missing behavior\" warnings on imported documents without elements',\n        async() => {\n          const document = await analyzeDocument(\n              'static/chained-missing-behavior/index.html');\n          const chainedDocument = getOnly(document.getFeatures({\n            kind: 'document',\n            id: 'static/chained-missing-behavior/chained.html',\n            imported: true\n          }));\n          const expectedWarning = {\n            code: 'unknown-polymer-behavior',\n            message:\n                'Unable to resolve behavior `NotFoundBehavior`. Did you import it? Is it annotated with @polymerBehavior?',\n            severity: 1,\n            sourceRange: {\n              end: {column: 55, line: 2},\n              start: {column: 39, line: 2},\n              file: 'static/chained-missing-behavior/chained.html'\n            },\n          };\n          assert.deepEqual(document.getWarnings({imported: false}), []);\n          assert.deepEqual(\n              document.getWarnings({imported: true}).map((w) => w.toJSON()),\n              [expectedWarning]);\n          assert.deepEqual(\n              chainedDocument.getWarnings({imported: false})\n                  .map((w) => w.toJSON()),\n              [expectedWarning]);\n        });\n\n    test(\n        'an inline document can find features from its container document',\n        async() => {\n          const document =\n              await analyzeDocument('static/analysis/behaviors/behavior.html');\n          const localDocuments =\n              document.getFeatures({kind: 'document', imported: false});\n          assert.equal(localDocuments.size, 2);  // behavior.html and its inline\n\n          const allDocuments =\n              document.getFeatures({kind: 'document', imported: true});\n          assert.equal(allDocuments.size, 4);\n\n          const inlineDocuments =\n              Array.from(document.getFeatures({imported: false}))\n                  .filter(\n                      (d) => d instanceof Document && d.isInline) as Document[];\n          assert.equal(inlineDocuments.length, 1);\n\n          // This is the main purpose of the test: get a feature from\n          // the inline\n          // document that's imported by the container document\n          const behaviorJsDocument = inlineDocuments[0];\n          const subBehavior = getOnly(behaviorJsDocument.getFeatures({\n            kind: 'behavior',\n            id: 'MyNamespace.SubBehavior',\n            imported: true\n          }));\n          assert.equal(subBehavior!.className, 'MyNamespace.SubBehavior');\n        });\n\n    test(\n        'an inline script can find features from its container document',\n        async() => {\n          const document = await analyzeDocument(\n              'static/script-tags/inline/test-element.html');\n          const inlineDocuments = Array\n                                      .from(document.getFeatures(\n                                          {kind: 'document', imported: false}))\n                                      .filter((d) => d.isInline);\n          assert.equal(inlineDocuments.length, 1);\n          const inlineJsDocument = inlineDocuments[0];\n\n          // The inline document can find the container's imported\n          // features\n          const subBehavior = getOnly(inlineJsDocument.getFeatures(\n              {kind: 'behavior', id: 'TestBehavior', imported: true}));\n          assert.equal(subBehavior!.className, 'TestBehavior');\n        });\n\n    test(\n        'an external script can find features from its container document',\n        async() => {\n          const document = await analyzeDocument(\n              'static/script-tags/external/test-element.html');\n\n          const htmlScriptTags = Array.from(\n              document.getFeatures({kind: 'html-script', imported: false}));\n          assert.equal(htmlScriptTags.length, 1);\n\n          const htmlScriptTag = htmlScriptTags[0] as ScriptTagImport;\n          const scriptDocument = htmlScriptTag.document;\n\n          // The inline document can find the container's imported\n          // features\n          const subBehavior = getOnly(scriptDocument.getFeatures(\n              {kind: 'behavior', id: 'TestBehavior', imported: true}))!;\n          assert.equal(subBehavior.className, 'TestBehavior');\n        });\n\n\n    // This test is nearly identical to the previous, but covers a different\n    // issue.\n    // PolymerElement must find behaviors while resolving, and if inline\n    // documents don't add a document feature for their container until after\n    // resolution, then the element can't find them and throws.\n    test(\n        'an inline document can find behaviors from its container document',\n        async() => {\n          const document = await analyzeDocument(\n              'static/analysis/behaviors/elementdir/element.html');\n\n          const documents =\n              document.getFeatures({kind: 'document', imported: false});\n          assert.equal(documents.size, 2);\n\n          const inlineDocuments = Array.from(documents).filter(\n              (d) => d instanceof Document && d.isInline) as Document[];\n          assert.equal(inlineDocuments.length, 1);\n\n          // This is the main purpose of the test: get a feature\n          // from the inline\n          // document that's imported by the container document\n          const behaviorJsDocument = inlineDocuments[0];\n          const subBehavior = getOnly(behaviorJsDocument.getFeatures({\n            kind: 'behavior',\n            id: 'MyNamespace.SubBehavior',\n            imported: true\n          }));\n          assert.equal(subBehavior.className, 'MyNamespace.SubBehavior');\n        });\n\n    test('returns a Document with warnings for malformed files', async() => {\n      const document = await analyzeDocument('static/malformed.html');\n      assert(document.getWarnings({imported: false}).length >= 1);\n    });\n\n    test('analyzes transitive dependencies', async() => {\n      const root = await analyzeDocument('static/dependencies/root.html');\n\n      // If we ask for documents we get every document in evaluation order.\n      const strictlyReachableDocuments = [\n        ['static/dependencies/root.html', 'html', false],\n        ['static/dependencies/inline-only.html', 'html', false],\n        ['static/dependencies/inline-only.html', 'js', true],\n        ['static/dependencies/inline-only.html', 'css', true],\n        ['static/dependencies/leaf.html', 'html', false],\n        ['static/dependencies/inline-and-imports.html', 'html', false],\n        ['static/dependencies/inline-and-imports.html', 'js', true],\n        ['static/dependencies/subfolder/in-folder.html', 'html', false],\n        ['static/dependencies/subfolder/subfolder-sibling.html', 'html', false],\n        ['static/dependencies/inline-and-imports.html', 'css', true],\n      ];\n\n      // If we ask for documents we get every document in\n      // evaluation order.\n      assert.deepEqual(\n          Array\n              .from(root.getFeatures(\n                  {kind: 'document', imported: true, noLazyImports: true}))\n              .map((d) => [d.url, d.parsedDocument.type, d.isInline]),\n          strictlyReachableDocuments);\n\n      assert.deepEqual(\n          Array.from(root.getFeatures({kind: 'document', imported: true}))\n              .map((d) => [d.url, d.parsedDocument.type, d.isInline]),\n          strictlyReachableDocuments.concat(\n              [['static/dependencies/lazy.html', 'html', false]]));\n\n\n      // If we ask for imports we get the import statements in evaluation order.\n      // Unlike documents, we can have duplicates here because imports exist in\n      // distinct places in their containing docs.\n      assert.deepEqual(\n          Array.from(root.getFeatures({kind: 'import', imported: true}))\n              .map((d) => d.url),\n          [\n            'static/dependencies/inline-only.html',\n            'static/dependencies/leaf.html',\n            'static/dependencies/inline-and-imports.html',\n            'static/dependencies/subfolder/in-folder.html',\n            'static/dependencies/subfolder/subfolder-sibling.html',\n            'static/dependencies/subfolder/in-folder.html',\n            'static/dependencies/lazy.html',\n          ]);\n\n      const inlineOnly = getOnly(root.getFeatures({\n        kind: 'document',\n        id: 'static/dependencies/inline-only.html',\n        imported: true\n      }));\n      assert.deepEqual(\n          Array\n              .from(inlineOnly!.getFeatures({kind: 'document', imported: true}))\n              .map((d) => d.parsedDocument.type),\n          ['html', 'js', 'css']);\n\n      const leaf = getOnly(root.getFeatures({\n        kind: 'document',\n        id: 'static/dependencies/leaf.html',\n        imported: true\n      }));\n      assert.deepEqual(\n          Array.from(leaf.getFeatures({kind: 'document', imported: true})),\n          [leaf]);\n\n      const inlineAndImports = getOnly(root.getFeatures({\n        kind: 'document',\n        id: 'static/dependencies/inline-and-imports.html',\n        imported: true\n      }));\n      assert.deepEqual(\n          Array\n              .from(inlineAndImports.getFeatures(\n                  {kind: 'document', imported: true}))\n              .map((d) => d.parsedDocument.type),\n          ['html', 'js', 'html', 'html', 'css']);\n      const inFolder = getOnly(root.getFeatures({\n        kind: 'document',\n        id: 'static/dependencies/subfolder/in-folder.html',\n        imported: true\n      }));\n      assert.deepEqual(\n          Array.from(inFolder.getFeatures({kind: 'document', imported: true}))\n              .map((d) => d.url),\n          [\n            'static/dependencies/subfolder/in-folder.html',\n            'static/dependencies/subfolder/subfolder-sibling.html'\n          ]);\n\n      // check de-duplication\n      assert.equal(\n          getOnly(inlineAndImports!.getFeatures({\n            kind: 'document',\n            id: 'static/dependencies/subfolder/in-folder.html',\n            imported: true\n          })),\n          inFolder);\n    });\n\n    test(`warns for files that don't exist`, async() => {\n      const url = '/static/does_not_exist';\n      const result = await analyzer.analyze([url]);\n      const warning = result.getDocument(url);\n      assert.isFalse(warning instanceof Document);\n    });\n\n    test('handles documents from multiple calls to analyze()', async() => {\n      await analyzer.analyze(['static/caching/file1.html']);\n      await analyzer.analyze(['static/caching/file2.html']);\n    });\n\n    test('handles mutually recursive documents', async() => {\n      const document = await analyzeDocument('static/circular/mutual-a.html');\n      const shallowFeatures = document.getFeatures({imported: false});\n      assert.deepEqual(\n          Array.from(shallowFeatures)\n              .filter((f) => f.kinds.has('document'))\n              .map((f) => (f as Document).url),\n          ['static/circular/mutual-a.html']);\n      assert.deepEqual(\n          Array.from(shallowFeatures)\n              .filter((f) => f.kinds.has('import'))\n              .map((f) => (f as Import).url),\n          ['static/circular/mutual-b.html']);\n\n      const deepFeatures = document.getFeatures({imported: true});\n      assert.deepEqual(\n          Array.from(deepFeatures)\n              .filter((f) => f.kinds.has('document'))\n              .map((f) => (f as Document).url),\n          ['static/circular/mutual-a.html', 'static/circular/mutual-b.html']);\n      assert.deepEqual(\n          Array.from(deepFeatures)\n              .filter((f) => f.kinds.has('import'))\n              .map((f) => (f as Import).url),\n          ['static/circular/mutual-b.html', 'static/circular/mutual-a.html']);\n    });\n\n    test(\n        'handles parallel analyses of mutually recursive documents',\n        async() => {\n          // At one point this deadlocked, or threw\n          // a _makeDocument error.\n          await Promise.all([\n            analyzer.analyze(['static/circular/mutual-a.html']),\n            analyzer.analyze(['static/circular/mutual-b.html'])\n          ]);\n        });\n\n    test('handles a document importing itself', async() => {\n      const document =\n          await analyzeDocument('static/circular/self-import.html');\n      const features = document.getFeatures({imported: true});\n      assert.deepEqual(\n          Array.from(features)\n              .filter((f) => f.kinds.has('document'))\n              .map((f) => (f as Document).url),\n          ['static/circular/self-import.html']);\n      assert.deepEqual(\n          Array.from(features)\n              .filter((f) => f.kinds.has('import'))\n              .map((f) => (f as Import).url),\n          [\n            'static/circular/self-import.html',\n            'static/circular/self-import.html'\n          ]);\n    });\n\n    suite('handles documents with spaces in filename', () => {\n\n      test('given a url with unencoded spaces to analyze', async() => {\n        const document = await analyzeDocument('static/spaces in file.html');\n        const features = document.getFeatures({imported: true});\n        assert.deepEqual(\n            Array.from(features)\n                .filter((f) => f.kinds.has('document'))\n                .map((f) => (f as Document).url),\n            [\n              'static/spaces%20in%20file.html',\n              'static/dependencies/spaces%20in%20import.html'\n            ]);\n        assert.deepEqual(\n            Array.from(features)\n                .filter((f) => f.kinds.has('import'))\n                .map((f) => (f as Import).url),\n            ['static/dependencies/spaces%20in%20import.html']);\n      });\n\n      test('given a url with encoded spaces to analyze', async() => {\n        const document =\n            await analyzeDocument('static/spaces%20in%20file.html');\n        const features = document.getFeatures({imported: true});\n        assert.deepEqual(\n            Array.from(features)\n                .filter((f) => f.kinds.has('document'))\n                .map((f) => (f as Document).url),\n            [\n              'static/spaces%20in%20file.html',\n              'static/dependencies/spaces%20in%20import.html'\n            ]);\n        assert.deepEqual(\n            Array.from(features)\n                .filter((f) => f.kinds.has('import'))\n                .map((f) => (f as Import).url),\n            ['static/dependencies/spaces%20in%20import.html']);\n      });\n    });\n  });\n\n  // TODO: reconsider whether we should test these private methods.\n  suite('_parse()', () => {\n\n    test('loads and parses an HTML document', async() => {\n      const context = await getContext(analyzer);\n      const doc = await context['_parse']('static/html-parse-target.html');\n      assert.instanceOf(doc, ParsedHtmlDocument);\n      assert.equal(doc.url, 'static/html-parse-target.html');\n    });\n\n    test('loads and parses a JavaScript document', async() => {\n      const context = await getContext(analyzer);\n      const doc = await context['_parse']('static/js-elements.js');\n      assert.instanceOf(doc, JavaScriptDocument);\n      assert.equal(doc.url, 'static/js-elements.js');\n    });\n\n    test('returns a Promise that rejects for non-existant files', async() => {\n      const context = await getContext(analyzer);\n      await invertPromise(context['_parse']('static/not-found'));\n    });\n  });\n\n  suite('_getScannedFeatures()', () => {\n    test('default import scanners', async() => {\n      const contents = `<html><head>\n          <link rel=\"import\" href=\"polymer.html\">\n          <script src=\"foo.js\"></script>\n          <link rel=\"stylesheet\" href=\"foo.css\"></link>\n        </head></html>`;\n      const document = new HtmlParser().parse(contents, 'test.html');\n      const context = await getContext(analyzer);\n      const features = ((await context['_getScannedFeatures'](document))\n                            .features as ScannedImport[]);\n      assert.deepEqual(\n          features.map((e) => e.type),\n          ['html-import', 'html-script', 'html-style']);\n      assert.deepEqual(\n          features.map((e) => e.url),  //\n          ['polymer.html', 'foo.js', 'foo.css']);\n    });\n\n    test('polymer css import scanner', async() => {\n      const contents = `<html><head>\n          <link rel=\"import\" type=\"css\" href=\"foo.css\">\n        </head>\n        <body>\n          <dom-module>\n            <link rel=\"import\" type=\"css\" href=\"bar.css\">\n          </dom-module>\n        </body></html>`;\n      const document = new HtmlParser().parse(contents, 'test.html');\n      const context = await getContext(analyzer);\n      const features =\n          (await context['_getScannedFeatures'](document))\n              .features.filter(\n                  (e) => e instanceof ScannedImport) as ScannedImport[];\n      assert.equal(features.length, 1);\n      assert.equal(features[0].type, 'css-import');\n      assert.equal(features[0].url, 'bar.css');\n    });\n\n    test('HTML inline document scanners', async() => {\n      const contents = `<html><head>\n          <script>console.log('hi')</script>\n          <style>body { color: red; }</style>\n        </head></html>`;\n      const context = await getContext(analyzer);\n      const document = new HtmlParser().parse(contents, 'test.html');\n      const features = ((await context['_getScannedFeatures'](document))\n                            .features) as ScannedInlineDocument[];\n\n      assert.equal(features.length, 2);\n      assert.instanceOf(features[0], ScannedInlineDocument);\n      assert.instanceOf(features[1], ScannedInlineDocument);\n    });\n\n    const testName =\n        'HTML inline documents can be cloned, modified, and stringified';\n    test(testName, async() => {\n      const contents = stripIndent(`\n        <div>\n          <script>\n            console.log('foo');\n          </script>\n          <style>\n            body {\n              color: blue;\n            }\n          </style>\n        </div>\n      `).trim();\n      const modifiedContents = stripIndent(`\n        <div>\n          <script>\n            console.log('bar');\n          </script>\n          <style>\n            body {\n              color: red;\n            }\n          </style>\n        </div>\n      `).trim();\n      inMemoryOverlay.urlContentsMap.set('test-doc.html', contents);\n      const origDocument = await analyzeDocument('test-doc.html');\n      const document = clone(origDocument);\n\n      // In document, we'll change `foo` to\n      // `bar` in the js and `blue` to\n      // `red` in the css.\n      const jsDocs =\n          document.getFeatures({kind: 'js-document', imported: true});\n      assert.equal(1, jsDocs.size);\n      const jsDoc = getOnly(jsDocs);\n      (jsDoc.parsedDocument as JavaScriptDocument).visit([{\n        enterCallExpression(node: estree.CallExpression) {\n          node.arguments =\n              [{type: 'Literal', value: 'bar', raw: 'bar'}] as estree.Literal[];\n        }\n      }]);\n\n      const cssDocs =\n          document.getFeatures({kind: 'css-document', imported: true});\n      assert.equal(1, cssDocs.size);\n      const cssDoc = getOnly(cssDocs);\n      (cssDoc.parsedDocument as ParsedCssDocument).visit([{\n        visit(node: shady.Node) {\n          if (node.type === 'expression' && node.text === 'blue') {\n            node.text = 'red';\n          }\n        }\n      }]);\n\n      // We can stringify the clone and get the modified contents, and\n      // stringify the original and still get the original contents.\n      assert.deepEqual(document.stringify(), modifiedContents);\n      assert.deepEqual(origDocument.stringify(), contents);\n    });\n  });\n\n  suite('documentation extraction', () => {\n    test('we get the wrong description for paper-input', async() => {\n      const document = await analyzeDocument('static/paper-input.html');\n      const [element] =\n          document.getFeatures({kind: 'element', id: 'paper-input'});\n      assert(\n          !/fresh new hell/.test(element.description),\n          `Doesn't pick up on unexpected html comments.`);\n      assert(\n          element.description.startsWith('Material design: [Text fields]'),\n          `Does get the message right.`);\n    });\n  });\n\n  test('analyzes a document with a namespace', async() => {\n    const document = await analyzeDocument('static/namespaces/import-all.html');\n    if (!(document instanceof Document)) {\n      throw new Error(`Expected Document, got ${document}`);\n    }\n\n    const namespaces =\n        Array.from(document.getFeatures({kind: 'namespace', imported: true}));\n    assert.deepEqual(namespaces.map((b) => b.name), [\n      'ExplicitlyNamedNamespace',\n      'ExplicitlyNamedNamespace.NestedNamespace',\n      'ImplicitlyNamedNamespace',\n      'ImplicitlyNamedNamespace.NestedNamespace',\n      'ParentNamespace.FooNamespace',\n      'ParentNamespace.BarNamespace',\n      'DynamicNamespace.ComputedProperty',\n      'DynamicNamespace.UnanalyzableComputedProperty',\n      'DynamicNamespace.Aliased',\n      'DynamicNamespace.InferredComputedProperty',\n    ]);\n  });\n\n  // TODO(rictic): move duplicate checks into scopes/analysis results.\n  //     No where else has reliable knowledge of the clash.\n  test.skip(\n      'creates warnings when duplicate namespaces are analyzed', async() => {\n        const document = await analyzer.analyze(\n            ['static/namespaces/import-duplicates.html']);\n        const namespaces =\n            Array.from(document.getFeatures({kind: 'namespace'}));\n        assert.deepEqual(namespaces.map((b) => b.name), [\n          'ExplicitlyNamedNamespace',\n          'ExplicitlyNamedNamespace.NestedNamespace',\n        ]);\n        const warnings = document.getWarnings();\n        assert.containSubset(warnings, [\n          {\n            message:\n                'Found more than one namespace named ExplicitlyNamedNamespace.',\n            severity: Severity.WARNING,\n            code: 'multiple-javascript-namespaces',\n          }\n        ]);\n        assert.deepEqual(await underliner.underline(warnings), [`\nvar DuplicateNamespace = {};\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~`]);\n      });\n\n  suite('analyzePackage', () => {\n\n    test('produces a package with the right documents', async() => {\n      const analyzer = new Analyzer({\n        urlLoader: new FSUrlLoader(path.join(testDir, 'static', 'project'))\n      });\n      const pckage = await analyzer.analyzePackage();\n\n      // The root documents of the package are a minimal set of documents whose\n      // imports touch every document in the package.\n      assert.deepEqual(\n          Array.from(pckage['_searchRoots']).map((d) => d.url).sort(),\n          ['cyclic-a.html', 'root.html', 'subdir/root-in-subdir.html'].sort());\n\n      // Note that this does not contain the bower_components/ files\n      assert.deepEqual(\n          Array.from(pckage.getFeatures({kind: 'document'}))\n              .filter((d) => !d.isInline)\n              .map((d) => d.url)\n              .sort(),\n          [\n            'cyclic-a.html',\n            'cyclic-b.html',\n            'root.html',\n            'leaf.html',\n            'subdir/subdir-leaf.html',\n            'subdir/root-in-subdir.html'\n          ].sort());\n\n      // And this does contain the one imported file in bower_components/\n      assert.deepEqual(\n          Array\n              .from(pckage.getFeatures(\n                  {kind: 'document', externalPackages: true}))\n              .filter((d) => !d.isInline)\n              .map((d) => d.url)\n              .sort(),\n          [\n            'cyclic-a.html',\n            'cyclic-b.html',\n            'root.html',\n            'leaf.html',\n            'subdir/subdir-leaf.html',\n            'subdir/root-in-subdir.html',\n            'bower_components/imported.html',\n          ].sort());\n\n      const packageElements = [\n        'root-root',\n        'leaf-leaf',\n        'cyclic-a',\n        'cyclic-b',\n        'root-in-subdir',\n        'subdir-leaf'\n      ];\n\n      // All elements in the package\n      assert.deepEqual(\n          Array.from(pckage.getFeatures({kind: 'element'}))\n              .map((e) => e.tagName)\n              .sort(),\n          packageElements.sort());\n\n      // All elements in the package, as well as all elements in\n      // its bower_components directory that are reachable from imports in the\n      // package.\n      assert.deepEqual(\n          Array\n              .from(\n                  pckage.getFeatures({kind: 'element', externalPackages: true}))\n              .map((e) => e.tagName)\n              .sort(),\n          packageElements.concat(['imported-dependency']).sort());\n    });\n\n    test('can get warnings from within and without the package', async() => {\n      const analyzer = new Analyzer({\n        urlLoader:\n            new FSUrlLoader(path.join(testDir, 'static', 'project-with-errors'))\n      });\n      const pckage = await analyzer.analyzePackage();\n      assert.deepEqual(\n          Array.from(pckage['_searchRoots']).map((d) => d.url), ['index.html']);\n      assert.deepEqual(\n          pckage.getWarnings().map((w) => w.sourceRange.file), ['index.html']);\n      assert.deepEqual(\n          pckage.getWarnings({externalPackages: true})\n              .map((w) => w.sourceRange.file)\n              .sort(),\n          ['bower_components/external-with-warnings.html', 'index.html']);\n    });\n  });\n\n  suite('_fork', () => {\n    test('returns an independent copy of Analyzer', async() => {\n      inMemoryOverlay.urlContentsMap.set('a.html', 'a is shared');\n      await analyzer.analyze(['a.html']);\n      // Unmap a.html so that future reads of it will fail, thus testing the\n      // cache.\n      inMemoryOverlay.urlContentsMap.delete('a.html');\n\n      const analyzer2 = await analyzer._fork();\n      inMemoryOverlay.urlContentsMap.set('b.html', 'b for analyzer');\n      await analyzer.analyze(['b.html']);\n      inMemoryOverlay.urlContentsMap.set('b.html', 'b for analyzer2');\n      await analyzer2.analyze(['b.html']);\n      inMemoryOverlay.urlContentsMap.delete('b.html');\n\n      const a1 = await analyzeDocument('a.html', analyzer);\n      const a2 = await analyzeDocument('a.html', analyzer2);\n      const b1 = await analyzeDocument('b.html', analyzer);\n      const b2 = await analyzeDocument('b.html', analyzer2);\n\n      assert.equal(a1.parsedDocument.contents, 'a is shared');\n      assert.equal(a2.parsedDocument.contents, 'a is shared');\n      assert.equal(b1.parsedDocument.contents, 'b for analyzer');\n      assert.equal(b2.parsedDocument.contents, 'b for analyzer2');\n    });\n\n    test('supports overriding of urlLoader', async() => {\n      const loader1 = {canLoad: () => true, load: async(u: string) => `${u} 1`};\n      const loader2 = {canLoad: () => true, load: async(u: string) => `${u} 2`};\n      const analyzer1 = new Analyzer({urlLoader: loader1});\n      const a1 = await analyzeDocument('a.html', analyzer1);\n      const analyzer2 = await analyzer1._fork({urlLoader: loader2});\n      const a2 = await analyzeDocument('a.html', analyzer2);\n      const b1 = await analyzeDocument('b.html', analyzer1);\n      const b2 = await analyzeDocument('b.html', analyzer2);\n\n      assert.equal(a1.parsedDocument.contents, 'a.html 1', 'a.html, loader 1');\n      assert.equal(a2.parsedDocument.contents, 'a.html 1', 'a.html, in cache');\n      assert.equal(b1.parsedDocument.contents, 'b.html 1', 'b.html, loader 1');\n      assert.equal(b2.parsedDocument.contents, 'b.html 2', 'b.html, loader 2');\n    });\n  });\n\n  suite('race conditions and caching', () => {\n    test('maintain caches across multiple edits', async() => {\n      // This is a regression test of a scenario where changing a dependency\n      // did not properly update warnings of a file. The bug turned out to\n      // be in the dependency graph, but this test seems useful enough to\n      // keep around.\n      // The specific warning is renaming a superclass without updating the\n      // class which extends it.\n      inMemoryOverlay.urlContentsMap.set('base.js', `\n        class BaseElement extends HTMLElement {}\n        customElements.define('base-elem', BaseElement);\n      `);\n      inMemoryOverlay.urlContentsMap.set('user.html', `\n        <script src=\"./base.js\"></script>\n        <script>\n          class UserElem extends BaseElement {}\n          customElements.define('user-elem', UserElem);\n        </script>\n      `);\n      const b1Doc = await analyzer.analyze(['base.js']);\n      assert.deepEqual(b1Doc.getWarnings(), []);\n      const u1Doc = await analyzer.analyze(['user.html']);\n      assert.deepEqual(u1Doc.getWarnings(), []);\n\n      inMemoryOverlay.urlContentsMap.set('base.js', `\n        class NewSpelling extends HTMLElement {}\n        customElements.define('base-elem', NewSpelling);\n      `);\n      analyzer.filesChanged(['base.js']);\n      const b2Doc = await analyzer.analyze(['base.js']);\n      assert.deepEqual(b2Doc.getWarnings(), []);\n      const u2Doc = await analyzer.analyze(['user.html']);\n      assert.notEqual(u1Doc, u2Doc);\n      assert.equal(\n          u2Doc.getWarnings()[0].message,\n          'Unable to resolve superclass BaseElement');\n\n      inMemoryOverlay.urlContentsMap.set('base.js', `\n        class BaseElement extends HTMLElement {}\n        customElements.define('base-elem', BaseElement);\n      `);\n      analyzer.filesChanged(['base.js']);\n      const b3Doc = await analyzer.analyze(['base.js']);\n      assert.deepEqual(b3Doc.getWarnings(), []);\n      const u3Doc = await analyzer.analyze(['user.html']);\n      assert.equal(u3Doc.getWarnings().length, 0);\n    });\n\n    class RacyUrlLoader implements UrlLoader {\n      constructor(\n          public pathToContentsMap: Map<string, string>,\n          private waitFunction: () => Promise<void>) {\n      }\n      canLoad() {\n        return true;\n      }\n      async load(path: string) {\n        await this.waitFunction();\n        const contents = this.pathToContentsMap.get(path);\n        if (contents != null) {\n          return contents;\n        }\n        throw new Error(`no known contents for ${path}`);\n      }\n    }\n\n    const editorSimulator = async(waitFn: () => Promise<void>) => {\n      // Here we're simulating a lot of noop-changes to base.html,\n      // which has\n      // two imports, which mutually import a common dep. This\n      // stresses the\n      // analyzer's caching.\n\n      const contentsMap = new Map<string, string>([\n        [\n          'base.html',\n          `<link rel=\"import\" href=\"a.html\">\\n<link rel=\"import\" href=\"b.html\">`\n        ],\n        ['a.html', `<link rel=\"import\" href=\"common.html\">`],\n        ['b.html', `<link rel=\"import\" href=\"common.html\">`],\n        ['common.html', `<custom-el></custom-el>`],\n      ]);\n      const analyzer =\n          new Analyzer({urlLoader: new RacyUrlLoader(contentsMap, waitFn)});\n      const promises: Promise<Document>[] = [];\n      const intermediatePromises: Promise<void>[] = [];\n      for (let i = 0; i < 1; i++) {\n        await waitFn();\n        for (const entry of contentsMap) {\n          // Randomly edit some files.\n          const path = entry[0];\n          if (Math.random() > 0.5) {\n            analyzer.filesChanged([path]);\n            analyzer.analyze([path]);\n            if (Math.random() > 0.5) {\n              analyzer.filesChanged([path]);\n              const p = analyzer.analyze([path]);\n              const cacheContext = await getContext(analyzer);\n              intermediatePromises.push((async() => {\n                await p;\n                const docs = Array.from(\n                    cacheContext['_cache'].analyzedDocuments.values());\n                assert.isTrue(new Set(docs.map((d) => d.url).sort()).has(path));\n              })());\n            }\n          }\n          promises.push(analyzeDocument('base.html', analyzer));\n          await Promise.all(promises);\n        }\n        // Analyze the base file\n        promises.push(analyzeDocument('base.html', analyzer));\n        await Promise.all(promises);\n      }\n      // Assert that all edits went through fine.\n      await Promise.all(intermediatePromises);\n      // Assert that the every analysis of 'base.html' after each\n      // batch of edits\n      // was correct, and doesn't have missing or inconsistent\n      // results.\n      const documents = await Promise.all(promises);\n      for (const document of documents) {\n        assert.deepEqual(document.url, 'base.html');\n        const localFeatures = document.getFeatures({imported: false});\n        const kinds = Array.from(localFeatures).map((f) => Array.from(f.kinds));\n        const message =\n            `localFeatures: ${\n                              JSON.stringify(\n                                  Array.from(localFeatures)\n                                      .map((f) => ({\n                                             kinds: Array.from(f.kinds),\n                                             ids: Array.from(f.identifiers)\n                                           })))\n                            }`;\n        assert.deepEqual(\n            kinds,\n            [\n              ['document', 'html-document'],\n              ['import', 'html-import'],\n              ['import', 'html-import']\n            ],\n            message);\n        const imports =\n            Array.from(document.getFeatures({kind: 'import', imported: true}));\n        assert.sameMembers(\n            imports.map((m) => m.url),\n            ['a.html', 'b.html', 'common.html', 'common.html']);\n        const docs = Array.from(\n            document.getFeatures({kind: 'document', imported: true}));\n        assert.sameMembers(\n            docs.map((d) => d.url),\n            ['a.html', 'b.html', 'base.html', 'common.html']);\n        const refs = Array.from(\n            document.getFeatures({kind: 'element-reference', imported: true}));\n        assert.sameMembers(refs.map((ref) => ref.tagName), ['custom-el']);\n      }\n    };\n\n    test('editor simulator of imports that import a common dep', async() => {\n      const waitTimes: number[] = [];\n      const randomWait = () => new Promise<void>((resolve) => {\n        const waitTime = Math.random() * 30;\n        waitTimes.push(waitTime);\n        setTimeout(resolve, waitTime);\n      });\n      try {\n        await editorSimulator(randomWait);\n      } catch (err) {\n        console.error('Wait times to reproduce this failure:');\n        console.error(JSON.stringify(waitTimes));\n        throw err;\n      }\n    });\n\n    /**\n     * This is a tool for reproducing and debugging a failure of the\n     * editor\n     * simulator test above, but only at the exact same commit, as\n     * it's\n     * sensitive to the order of internal operations of the analyzer.\n     * So this\n     * code with a defined list of wait times should not be checked\n     * in.\n     *\n     * It's also worth noting that this code will be dependent on many\n     * other\n     * system factors, so it's only somewhat more reproducible, and\n     * may not\n     * end\n     * up being very useful. If it isn't, we should delete it.\n     */\n    test.skip('somewhat more reproducable editor simulator', async() => {\n      // Replace waitTimes' value with the array of wait times\n      // that's logged\n      // to the console when the random editor test fails.\n      const waitTimes: number[] = [];\n\n      const reproducableWait = () => new Promise<void>((resolve) => {\n        const waitTime = waitTimes.shift();\n        if (waitTime == null) {\n          throw new Error(\n              'Was asked for more random waits than the ' +\n              'given array of wait times');\n        }\n        setTimeout(resolve, waitTime);\n      });\n      await editorSimulator(reproducableWait);\n    });\n\n    suite('deterministic tests', () => {\n      // Deterministic tests extracted from various failures of the\n      // above\n      // random\n      // test.\n\n      /**\n       * This is an asynchronous keyed queue, useful for controlling\n       * the\n       * order\n       * of results in order to make tests more deterministic.\n       *\n       * It's intended to be used in fake loaders, scanners, etc,\n       * where the\n       * test\n       * provides the intended result on a file by file basis, with\n       * control\n       * over\n       * the order in which the results come in.\n       */\n      class KeyedQueue<Key, Result> {\n        private _requests = new Map<Key, Deferred<Result>[]>();\n        private _results = new Map<Key, Result[]>();\n\n        async request(key: Key): Promise<Result> {\n          const results = this._results.get(key) || [];\n          if (results.length > 0) {\n            return results.shift()!;\n          }\n          const deferred = new Deferred<Result>();\n          const deferreds = this._requests.get(key) || [];\n          this._requests.set(key, deferreds);\n          deferreds.push(deferred);\n          return deferred.promise;\n        }\n\n        /**\n         * Resolves the next unfulfilled request for the given key\n         * with the\n         * given value.\n         */\n        resolve(key: Key, value: Result) {\n          const requests = this._requests.get(key) || [];\n          if (requests.length > 0) {\n            const request = requests.shift()!;\n            request.resolve(value);\n            return;\n          }\n          const results = this._results.get(key) || [];\n          this._results.set(key, results);\n          results.push(value);\n        }\n\n        toString() {\n          return JSON.stringify({\n            openRequests: Array.from(this._requests.keys()),\n            openResponses: Array.from(this._results.keys())\n          });\n        }\n      }\n\n      class DeterministicUrlLoader implements UrlLoader {\n        queue = new KeyedQueue<string, string>();\n        canLoad(_url: string) {\n          return true;\n        }\n\n        async load(url: string) {\n          return this.queue.request(url);\n        }\n      }\n\n      class NoopUrlLoader implements UrlLoader {\n        canLoad() {\n          return true;\n        }\n        async load(): Promise<string> {\n          throw new Error(\n              `Noop Url Loader isn't supposed to be actually called.`);\n        }\n      }\n\n      /**\n       * This crashed the analyzer as there was a race to\n       * _makeDocument,\n       * violating its constraint that there not already be a resolved\n       * Document\n       * for a given path.\n       *\n       * This test came out of debugging this issue:\n       *     https://github.com/Polymer/polymer-analyzer/issues/406\n       */\n      test('two edits of the same file back to back', async() => {\n        const overlay = new InMemoryOverlayUrlLoader(new NoopUrlLoader);\n        const analyzer = new Analyzer({urlLoader: overlay});\n\n        overlay.urlContentsMap.set('leaf.html', 'Hello');\n        const p1 = analyzer.analyze(['leaf.html']);\n        overlay.urlContentsMap.set('leaf.html', 'World');\n        analyzer.filesChanged(['leaf.html']);\n        const p2 = analyzer.analyze(['leaf.html']);\n        await Promise.all([p1, p2]);\n      });\n\n      test('handles a shared dependency', async() => {\n        const initialPaths =\n            ['static/diamond/a.html', 'static/diamond/root.html'];\n        let result = await analyzer.analyze(initialPaths);\n\n        const documentA = result.getDocument(initialPaths[0]) as Document;\n        inMemoryOverlay.urlContentsMap.set(\n            'static/diamond/a.html', documentA.parsedDocument.contents);\n        await analyzer.filesChanged(['static/diamond/a.html']);\n        result = await analyzer.analyze(initialPaths);\n\n        const root = result.getDocument(initialPaths[1]) as Document;\n\n        const localFeatures = root.getFeatures({imported: false});\n        const kinds = Array.from(localFeatures).map((f) => Array.from(f.kinds));\n        assert.deepEqual(kinds, [\n          ['document', 'html-document'],\n          ['import', 'html-import'],\n          ['import', 'html-import']\n        ]);\n      });\n\n      test('all files in a cycle wait for the whole cycle', async() => {\n        const loader = new DeterministicUrlLoader();\n        const analyzer = new Analyzer({urlLoader: loader});\n        const aAnalyzed = analyzer.analyze(['a.html']);\n        const bAnalyzed = analyzer.analyze(['b.html']);\n\n        loader.queue.resolve('a.html', `<link rel=\"import\" href=\"b.html\">\n            <link rel=\"import\" href=\"c.html\">`);\n        loader.queue.resolve('b.html', `<link rel=\"import\" href=\"a.html\">`);\n\n        let cResolved = false;\n        // Analysis shouldn't finish without c.html resolving\n        const aAnalyzedDone = aAnalyzed.then(() => {\n          assert.isTrue(cResolved);\n        });\n        const bAnalyzedDone = bAnalyzed.then(() => {\n          assert.isTrue(cResolved);\n        });\n        // flush the microtask queue\n        await Promise.resolve();\n        cResolved = true;\n        loader.queue.resolve('c.html', '');\n        // wait for the callback above to complete\n        await Promise.all([aAnalyzedDone, bAnalyzedDone]);\n      });\n\n      test('analyzes multiple imports of the same behavior', async() => {\n        const documentA = await analyzer.analyze(\n            ['static/multiple-behavior-imports/element-a.html']);\n        const documentB = await analyzer.analyze(\n            ['static/multiple-behavior-imports/element-b.html']);\n        assert.deepEqual(documentA.getWarnings({imported: true}), []);\n        assert.deepEqual(documentB.getWarnings({imported: true}), []);\n      });\n\n      test(\n          'analyzes multiple imports of the same behavior simultaneously',\n          async() => {\n            const result = await Promise.all([\n              analyzer.analyze(\n                  ['static/multiple-behavior-imports/element-a.html']),\n              analyzer.analyze(\n                  ['static/multiple-behavior-imports/element-b.html'])\n            ]);\n            const documentA = result[0];\n            const documentB = result[1];\n            assert.deepEqual(documentA.getWarnings({imported: true}), []);\n            assert.deepEqual(documentB.getWarnings({imported: true}), []);\n          });\n    });\n  });\n});\n\nasync function getContext(analyzer: Analyzer) {\n  return await analyzer['_analysisComplete'];\n};\n"]}